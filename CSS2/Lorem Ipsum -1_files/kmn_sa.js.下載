var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};var kmn_data=window.kmn_data||{},kmn_iframe=window.kmn_iframe||0,kmn_overlay=window.kmn_overlay||{},kmn_ts=window.kmn_ts||new Date().getTime(),kmn_next=window.kmn_next||{},kmn_house=window.kmn_house||{},kmn_cb=generateCb(),kmn_cstat=window.kmn_cstat||new function(){var a=this;a.createScriptElement=function(g,f){var c=kmn_sa,d=document.createElement("script");var b=c.extend(f||{},{src:g,async:true,type:"text/javascript"});if(b.hasOwnProperty("text")){d.text=b.text;delete b.text;delete b.src}c.setAttributes(d,b);return d};a.async_js=function(d,c){try{var f,b=a.createScriptElement(d,c);f=document.getElementsByTagName("head")[0];if(f){f.appendChild(b)}return b}catch(g){kmn_sa.log(g.message)}return""};a.stat_src=function(b,f){var c,d="?",f=f||{};for(c in f){d+=encodeURIComponent(c)+"="+encodeURIComponent(f[c])+"&"}return b+d.slice(0,-1)};a.save=function(d,j){try{var g=a.stat_src("",j).substring(1);var f={success:function i(k){try{kmn_sa.log("xhr success["+k+"]",1);var l=k.indexOf("*/");var n=l===-1?k:k.substring(l+2);if(n.length>0){a.async_js(null,{text:n})}}catch(m){kmn_sa.log(m.message)}},error:function c(k,m){try{kmn_sa.log("xhr error["+k+"]status["+m.status+"]");a.bck(d,kmn_sa.extend(j||{},{bck:true,xhr:m.status,res:k}))}catch(l){kmn_sa.log(l.message)}}};var b={method:"POST",withCredentials:true,contentType:"application/x-www-form-urlencoded"};a.ajax(d,f,g,b)}catch(h){kmn_sa.log(h)}};a.bck=function(c,f){var d=a.stat_src(c,f),b=a.async_js(d,{});kmn_sa.log("bck ["+d+"]");b.onload=b.onreadystatechange=function(){var g=b.readyState;if(!g||g==="loaded"||g==="complete"){b.onload=b.onreadystatechange=null;if(b.parentNode){b.parentNode.removeChild(b)}}};return b};a.ajax=function(d,h,f,l){try{var g=4,i=3000;var k,c=false,l=l||{},b=l.method||(f?"POST":"GET");if(!window.XMLHttpRequest){c=true}else{k=new window.XMLHttpRequest();if(k.responseType===undefined){c=true}}if(c){k=new window.XDomainRequest();k.onload=function(){h.success(k.responseText,k)};k.onerror=function(){h.error("error",k)};k.ontimeout=function(){h.error("timeout",k)}}else{k.onreadystatechange=function(){if(k.readyState===g){var m=k.status;if(m>=200&&m<300||m===304){h.success(k.responseText,k)}else{h.error(k.statusText,k)}}}}k.open(b,d);k.timeout=i;if(!c){if(l.withCredentials){k.withCredentials=true}if(l.preflight){k.setRequestHeader("X-Requested-With","XMLHttpRequest")}k.setRequestHeader("Content-Type",l.contentType||"text/plain")}k.send(b==="POST"&&f)}catch(j){kmn_sa.log("xhr ["+j+"]")}}}(),kmn_sa=kmn_sa||new function(){var j=this;j.is_iframe=function(){var l=false;try{l=d.location!==d.parent.location}catch(m){}return l};j.getDoc=function(){var l=null;try{l=j.is_iframe()?d.frameElement.contentDocument||d.frameElement.contentWindow.document:document}catch(m){}return l||document};j.getIfrmDoc=function(l){var m=l.contentDocument?l.contentDocument:l.contentWindow?l.contentWindow.document:l.document?l.document:null;return m};j.getParent=function(){var l=null;try{if(d.parent.document){l=d.parent}}catch(m){}return l};j.extend=function(){var n=0,m,l={};for(;n<arguments.length;n++){for(m in arguments[n]){l[m]=l[m]||arguments[n][m]}}return l};var i=".komoona.com/",b="kmn_tag_",c="kmni_",a="kmn-div",f="kmn-debug=true",h=kmn_cstat,d=window,g=j.getDoc(),k=j.extend(d.kmn_options||{},{base_url:"//a"+i,ext_src:"//cdn"+i+"scripts/kmn",debug:0,stat_url:"//stat"+i+"s",s2s_url:"//s2s"+i,np:"//s"+i+"passback/np/",sa:"sa",v:"4.6.14",cs:{}});j.options=k;j.tags={};j.statTimerInterval=250;j.stMx=30000/j.statTimerInterval;j.ifrmMx=3000/j.statTimerInterval;j.servingByHeightLowThreshold=0/j.statTimerInterval;j.servingByHeightHighThreshold=2500/j.statTimerInterval;j.hdbdTagTimeout=200;j.maxHdbdTagRetries=50;j.hdbdRetryWait=50;j.HDBD_STATE_RECEIVED="received";j.HDBD_STATE_TIMEOUT="timedOut";j.HDBD_STATE_FULL="full";j.handleChainedVideoTag=function(n,m,o,l){j.spark(n,{err:"video@sa",msg:e.message});j.get_np(n)};j.build_js=function(m,l,n){return"<script "+(n?'id="'+n+'" ':"")+'type="text/javascript"'+(l?">"+m:' src="'+m+'">')+"<\/script>"};j.write_js=function(l,m){g.write(j.build_js(l,0,m))};j.write_css_link=function(l,m){var n=j.setAttributes(g.createElement("link"),{type:"text/css",rel:"stylesheet",href:m,media:"all"});if(l){l.appendChild(n)}};j.setAttributes=function(n,m){try{if(n){for(var l in m){n.setAttribute(l,m[l])}}return n}catch(o){}return null};j.safeGetBoundingClientRect=function(m){try{var l=m.getBoundingClientRect();if(!("width" in l)||!("height" in l)){return{bottom:l.bottom,height:m.offsetHeight,left:l.left,right:l.right,top:l.top,width:m.offsetWidth}}else{return l}}catch(n){j.log("ERROR: failed in running getBoundingClientRect "+n.message);return{bottom:0,height:0,left:0,right:0,top:0,width:0}}};j.cssClass=function(n){try{var p=g.createElement("style"),m="",l=g.getElementsByTagName("head")[0];for(var o in n){m+="."+o+"{"+n[o]+"}"}p.appendChild(g.createTextNode(m));p.setAttribute("type","text/css");if(l){l.appendChild(p)}}catch(q){}};j.handleIframeFlickering=function(l){try{l.style.visibility="hidden";l.onload=function(){this.style.visibility="visible"}}catch(m){j.log("ERROR setting iframe style or onload: "+m.message)}};j.isOverlay=function(l){try{if(typeof kmn_overlay!=="undefined"&&kmn_overlay[l]){return kmn_overlay[l]}else{if(typeof window.top.kmn_overlay!=="undefined"&&window.top.kmn_overlay[l]){return window.top.kmn_overlay[l]}}}catch(m){j.log("ERROR checking overlay: "+m.message)}return false};j.create_iframe=function(p,m,l,o){var n=g.createElement("iframe");if(o){j.handleIframeFlickering(n)}j.setAttributes(n,j.extend(l||{},{src:p,marginHeight:0,marginWidth:0,frameBorder:0,scrolling:"no"}));if(m){m.appendChild(n)}return n};j.get_np=function(l){if(d.kmn_passbacks&&kmn_passbacks[l]){kmn_np.next(l)}else{if(kmn_next[l]){delete kmn_next[l]}j.write_js(k.np+l+".js")}};j.callS2s=function(n,p){if(p&&p.codes){var m,o,q=j.getDoc(),l=j.tags[n]||{},r={layoutid:n,chain:p.codes,cb:kmn_cb,index:p.full_index-1,uts:new Date().getTime(),inFrame:j.is_iframe()?1:0,url:j.site_url(),tz:new Date().getTimezoneOffset(),v:j.options.v};if(q){o=q.characterSet?q.characterSet:q.charset;if(o){r.ch=o}}m=h.stat_src(k.s2s_url+"GetAd",r);j.log("s2s["+m+"]");return j.build_js(m,0)}else{j.spark(n,{err:"callS2s@sa",msg:"empty data"});return""}};j.callS2sCallbackFunction=function(n,p,q,s){if(p&&p.codes){var m,l,r=j.getDoc(),t=j.tags[n]||{},o={layoutid:n,chain:p.codes,cb:kmn_cb,index:p.full_index-1,uts:new Date().getTime(),inFrame:j.is_iframe()?1:0,url:j.site_url(),tz:new Date().getTimezoneOffset(),v:j.options.v};if(s){o.callback=s}if(r){l=r.characterSet?r.characterSet:r.charset;if(l){o.ch=l}}m=h.stat_src(j.options.s2s_url+q,o);j.log("s2s["+m+"]");return j.write_js(m,0)}else{j.spark(n,{err:"callS2sCallback@sa",msg:"empty data"});return""}};j.s2sServerIncrement=function(m,r,t,n){var l=j.getDataVar(m,"full_index"),o=l,s=l+r-1;var q=j.getDataVar(m,"order");var p=j.getDataVar(m,"codes");if(r>1&&l){for(;o<s&&o<p.length;o++){q=p[o].split("").reverse().join("")+"|"+q}if(s>=p.length){j.spark(m,{err:"warn:idx@s2s",idx:s,curCh:p.length,ord:q})}j.setDataVar(m,"order",q);j.setDataVar(m,"full_index",s)}j.setDataVar(m,"s2sServedCode",n);if(t){j.setDataVar(m,"tagSurelyServed",true)}else{if(kmn_next[m]){delete kmn_next[m]}}};j.useS2sOn=function(l,o){var n=j.getDataVar(l,"s2sAdTags",[]);var m=j.getDataVar(l,"s2sCodes",[]);var p=j.getDataVar(l,"s2sExcludedTags",[]);if((n.indexOf(o)>-1||m.indexOf(o[0])>-1)&&p.indexOf(l)<0){return true}return false};j.renderInImage=function(n){if(!n){j.log("Warning: ii config issue");return}try{j.log("renderInImage called");try{if(d.top.inimage_started){return}d.top.inimage_started=true;d.top.kmn_i3_pid=n}catch(p){j.log("debug: ii in an unfriendly iframe");return}var m=h.createScriptElement(j.options.ext_src+"_i3_c.js",{async:false});var o=j.getTopDoc(),l=o?o.getElementsByTagName("head")[0]:null;if(l){l.appendChild(m);j.log("debug: ii injected to head")}else{j.spark(n,{err:"render@ii",msg:"failed to get win.top head"})}}catch(p){j.spark(n,{err:"render@ii",msg:p.message})}};j.site_url=function(){var m="",l="";m=l=j.is_iframe()&&g.referrer!==""?g.referrer:d.location.href;if(m.indexOf("javascript:window")!==-1||m.indexOf("about:blank")!==-1){try{m=d.parent.location.href}catch(n){m=l}}if(m.length>1024){m=m.replace(/([^:]+:\/\/[^\/]+).*/,"$1")}return m};j.is_debug=function(){try{var n=0,p=0,m=d.location.href,l=m.slice(m.indexOf("?")+1).split("&");for(;n<l.length;n++){if(l[n]===f){p=1}}k.debug=p;if(p&&!d.console){d.console={log:function o(){}}}}catch(q){}};j.live_tags=function(n){var l,m=[];for(l in j.tags){if(l!==n&&!j.tags[l].parent){m.push(l)}}return m};j.spark=function(n,p){try{var t=j.extend({tagid:n,v:k.v,cb:kmn_cb,ds:g.readyState},p||{}),y=j.live_tags(n);if(p.codes){j.set_ts(n,"s");j.tags[n].div=j.getWrapper(n);j.parentDiv(n)}if(j.tags[n]){var q=j.tags[n].ts||[];t.ts=q.join("|")}if(y.length){t.p=y.join(";")}if(!t.l){t.d=j.site_url()}var r=j.getDataVar(n,"kbWinningElement");if(r){j.addIfExists(t,r,"sb");t.kbwt=r.code;t.kbwb=r.cpm}var u=j.getBidDataForACall(n);if(u&&u.length>2){t.hb=u}var m=j.getDataVar(n,"hdbdResponseInUse");if(m&&m.hb_tp){t.hb_tp=m.hb_tp}j.addStatVars(n,t,["hdbdServed","hdbdResponseTime","winning_bid","qs","qg","qf","gf","hdbdId","hbtype","s2sServedCode","s2s_type"],{winning_bid:"wb",hdbdResponseTime:"hdbdrt",hdbdServed:"hbs",s2sServedCode:"s2sc"});var l=j.getDataVar(n,"cpm");var s=j.getDataVar(n,"winning_bid");var x=j.getDataVar(n,"hdbdServed");if(s&&x){t.cpm=s}else{if(l){t.cpm=l}}if(d.kmn_np){t.npv=d.kmn_np.v||"1.00"}if(d.screen){t.sw=d.screen.width;t.sh=d.screen.height}var w=j.getDataVar(n,"bb_code");if(w){t.bb_code=w}var o=j.getMyBigBrotherTagid(n);if(o){t.bb_pl=o}j.log("sprk"+j.stringify(t),1);h.save(k.stat_url,t,n);return t}catch(v){j.log("sprk["+v.message+"]",1)}};j.addStatVars=function(m,o,l,p){for(var n in l){var r=l[n];var q=j.getDataVar(m,r);if(q){if(p[r]){r=p[r]}o[r]=q}}};j.parentDiv=function(l){try{var m=j.getParent();if(m&&m.kmn_sa&&m.kmn_sa.tags[l]){m.kmn_sa.tags[l].div=j.tags[l].div;var o=m.parent||{};if(o.kmn_sa&&o.kmn_sa.tags[l]){o.kmn_sa.tags[l].div=j.tags[l].div}}}catch(n){}};j.set_ts=function(n,p){try{var l=j.tags[n]||{},o=new Date().getTime()-kmn_ts,m=l.ts||[];m.push(p+":"+o)}catch(q){j.spark(n,{err:"setts@sa",msg:q.message})}return o||-1};j.log=function(r,l){if(k.debug){var q=new Date(),n=q.getHours()+":"+q.getMinutes()+":"+q.getSeconds()+":"+q.getMilliseconds(),o="na/xd",m="";try{o=j.is_iframe()?d.frameElement.id:"top"}catch(p){}if(typeof l!=="undefined"){switch(l){case 1:m="color:blue;";break;case 2:m="color:green;";break;case 3:m="color:orange;";break}}d.console.log("%c[%s][%s]%s",m,n,o,r)}};j.console=function(l){j.log(l)};j.fetch_np=function(m){try{if(m.indexOf("_")===-1&&!kmn_next[m]){kmn_next[m]={render:false};var l=h.async_js(k.np+m+".js",{id:"np-"+m});l.onload=l.onreadystatechange=function(){var o=l.readyState;if(!o||o==="loaded"||o==="complete"){l.onload=l.onreadystatechange=null;kmn_next[m]={render:true};l.removeAttribute("id");j.set_ts(m,"np");j.log("np@d["+m+"]")}}}}catch(n){j.spark(m,{err:"fetchnp@sa",msg:n.message})}};j.initTagParams=function(m,n){try{n=n||null;j.xd=j.xd||komoona_xd.receive(function(q){j.handle(q.data)});if(!Function.prototype.bind){Function.prototype.bind=function(q){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind")}var u=Array.prototype.slice.call(arguments,1),t=this,r=function r(){},s=function s(){return t.apply(this instanceof r?this:q,u.concat(Array.prototype.slice.call(arguments)))};if(this.prototype){r.prototype=this.prototype}s.prototype=new r();return s}}if(!Array.prototype.indexOf&&!d.kmn_bc){j.write_js(k.ext_src+"-bc.js")}}catch(o){j.spark(m,{err:"itp@sa",msg:o.message})}j.tags[m]={srv:0,timer:null,ifrm:0,st:0,ts:[],start:kmn_ts,async:kmn_iframe,wait:0,cnt:1};j.set_ts(m,"t");var p=g.getElementById(c+m);if(p){j.tags[m].async=1}if(!j.tags[m].async){j.fetch_np(m);j.log("kmn_sa initTagParams: fetcing np")}else{j.log("kmn_sa initTagParams: not fetcing np")}kmn_iframe=0;var l=null;var n=n||j.getMyBigBrotherTagid(m);if(n){j.initTagParamsOfAutoRefresh(m,n);l=function l(q){kmn_sa.autoRefreshServed(q)}}j.statTimer(m,l)};j.replaceTagParams=function(m,l){if(j.tags[m]){d.clearInterval(j.tags[m].timer);j.tags[l]=j.extend(j.tags[m]);j.tags[m].parent=l;j.statTimer(l)}};j.getWrapper=function(m){var l=j.getDoc();if(l){return l.getElementById(b+m)}return null};j.elemHeight=function(p){var n=-1;try{if(p){if(p.getBoundingClientRect){var o=p.getBoundingClientRect();if(o.top&&o.bottom){n=o.bottom-o.top}}if(n===-1){var m=p.clientHeight||0,q=p.offsetHeight||0,l=p.scrollHeight||0;n=Math.max(q,m,l)}}}catch(r){}return n};j.statsParams=function(l){var n={h:j.elemHeight(j.getWrapper(l))},m=kmn_data[l];if(m){n.o=m.order;n.ch=m.codes?m.codes.join("|"):"";n.ch_orig=m.codes_orig?m.codes_orig.join("|"):""}return n};j.label=function(o,n){try{var m,l=j.tags[o],p=kmn_data[o],r=j.getWrapper(o);if(l.lbl&&p&&r&&n!==0){m=j.setAttributes(g.createElement("a"),{id:"lbl_"+o,"class":"kmn-lbl",target:"_blank",href:l.lbl.lnk});m.appendChild(g.createTextNode(l.lbl.txt));r.style.width=p.w+"px";r.style.height=p.h+"px";r.appendChild(m)}return m}catch(q){j.spark(o,{err:"label@sa",msg:q.message})}};j.house=function(m){try{var p=j.statsParams(m),l=p.o,o=p.h!==-1;if(!j.hasServingEnded(m)){j.setServingEnded(m);if(l.indexOf("h")===-1){p.o="h"+(l.length?"|"+l:"")}p.had=1;p.l=j.site_url();j.set_ts(m,"h");j.set_ts(m,"p")}else{p.house=1;o=j.tags[m].cnt===1&&o}j.log("house|"+m+"|"+j.stringify(p));if(o){j.spark(m,p)}}catch(n){j.spark(m,{err:"house@sa",msg:n.message})}};j.stats=function(l,m){if(!j.hasServingEnded(l)){j.setServingEnded(l);j.log("stats["+l+"]o["+m.o+"]h["+m.h+"]");m.l=j.site_url();if(m.status&&m.status==6){m.hic=j.getDataVar(l,"servedByHeightCount")}j.spark(l,m)}};j.hasServingEnded=function(l){if(j.tags[l]&&j.tags[l].srv){return 1}return 0};j.setServingEnded=function(l){var m=0;if(!j.tags[l]){j.tags[l]={}}m=j.tags[l].srv||0;j.tags[l].srv=1;return m};j.expectingPassbackInIframe=function(l){var n={x:true,p:true,Y:true};var m=j.getCurrentServedTagNetwork(l);if(n[m]){return true}return false};j.statTimer=function(l,m){if(!m&&d.kmn_serving_callback&&typeof d.kmn_serving_callback==="function"){m=d.kmn_serving_callback}j.tags[l].timer=d.setInterval(function(){j.statHandler(l,m)},j.statTimerInterval)};j.statHandler=function(n,m){var t=j.tags[n]||{};if(j.hasServingEnded(n)){d.clearInterval(t.timer)}else{t.st+=1;var p=j.statsParams(n),l=j.getWrapper(n),o=p.o||"",r=0;if(l){j.setDataVar(n,"wfo",true);if(t.st===j.stMx){j.set_ts(n,"tsa");j.spark(n,{o:o,h:p.h,err:"timeout@sa"})}if(o.indexOf("h")===-1){var s=j.detectAdServed(n,p);if(s.served){if(s.how==="hook"){r=2}else{var q=j.hasVisibleIframesWithSize(n,l);if(!j.expectingPassbackInIframe(n)||!q){if(s.how==="height"){r=j.handleHeightDetected(n)}else{if(s.how==="os_dom"){r=4}else{r=8}}}else{r=j.handleIframeDetected(n)}}if(r){j.handleServedDetected(n,r,p,m)}}else{if(j.getDataVar(n,"servedByHeightCount")>0){j.set_ts(n,"fsbh");j.setDataVar(n,"servedByHeightCount",0);j.deleteDataVar(n,"candidateForServingByHeight")}}}}else{if(t.st===50){j.set_ts(n,"wsa");var p={err:"wrapper@sa",o:o};if(j.getDataVar(n,"wfo")){p.wfo=true}j.spark(n,p)}}}};j.handleHeightDetected=function(o){var l=0;if(j.getDataVar(o,"candidateForServingByHeight")){if(j.getCurrentServedTag(o)!==j.getDataVar(o,"candidateForServingByHeight")){if(!j.getDataVar(o,"tagHeightChanged")){var m=j.getDataVar(o,"candidateForServingByHeight");j.setDataVar(o,"tagHeightChanged",m);j.set_ts(o,"hc_"+m)}j.setDataVar(o,"servedByHeightThreshold",j.servingByHeightHighThreshold);j.setDataVar(o,"candidateForServingByHeight",j.getCurrentServedTag(o));j.setDataVar(o,"servedByHeightCount",0)}}else{j.setDataVar(o,"candidateForServingByHeight",j.getCurrentServedTag(o))}var n=j.getIntervalsToWaitForHeight(o);if(j.getDataVar(o,"servedByHeightCount")>n){l=6}else{j.incrementDataVar(o,"servedByHeightCount")}return l};j.handleIframeDetected=function(m){var l=0;var o=j.getDataVar(m,"ifrmServingCandidate");var n=j.getCurrentServedTag(m);if(o!=n){j.setDataVar(m,"ifrmServingCandidate",n);j.setDataVar(m,"ifrmServingCount",0)}else{j.incrementDataVar(m,"ifrmServingCount")}if(j.getDataVar(m,"ifrmServingCount")>=j.ifrmMx){l=3}return l};j.handleServedDetected=function(m,l,p,o){j.label(m,l);var n=j.getCurrentServedTag(m);if(n){j.set_ts(m,n)}j.set_ts(m,"p");p.status=l;j.stats(m,p);j.runAutoRefreshTimeout(m,n);if(o){o(m,l,n)}};j.getIntervalsToWaitForHeight=function(l){var m=j.getDataVar(l,"servedByHeightThreshold",j.servingByHeightLowThreshold);if(j.getCurrentServedTagNetwork(l)==="S"){m=j.servingByHeightHighThreshold}return m};j.hasVisibleIframesWithSize=function(m,p){if(p){var o=p.getElementsByTagName("iframe");for(var n=0;n<o.length;n++){var l=j.safeGetBoundingClientRect(o[n]);if(o[n].style&&l.height>0&&o[n].style.display!=="none"){return true}}}return false};j.getCurrentServedTag=function(n){var o=null;var m=j.getDataVar(n,"codes");var l=j.getDataVar(n,"full_index");if(m&&typeof l!=="undefined"){o=m[l-1]}return o};j.getCurrentServedTagNetwork=function(l){var n=null;var m=j.getCurrentServedTag(l);if(m&&m.length>0){n=m.substr(0,1)}return n};j.detectAdServed=function(l,n){var o={served:false,how:undefined};var r=j.getDataVar(l,"hdbdServed");var p=j.getDataVar(l,"tagSurelyServed");if(r||p){o.served=true;o.how="hook"}else{var q=j.getCurrentServedTagNetwork(l);if(j.isOutStreamNetwork(q)){var t=j.detectServedOsByDom(l,n,q);if(t){o.served=true;o.how="os_dom"}}else{var s=j.getDataVar(l,"h",50);var m=j.detectServedByHeight(s,n,q);if(m){o.served=true;o.how="height"}}}return o};j.getTopDoc=function(){try{return d.top.document}catch(l){j.log("Cant get top window document");return null}};j.isOutStreamNetwork=function(l){var m=["V","A"];return m.indexOf(l)!=-1};j.detectServedOsByDom=function(l,o,m){try{switch(m){case"V":return j.detectOsServedConvert(o);case"A":return j.detectOsServedTeads(o);default:return false}}catch(n){j.spark(l,{err:"err@detectServedOsByDom",msg:n.message});return false}};j.detectOsServedConvert=function(r){var l=j.getTopDoc();if(!l){return false}var q;try{q=l.getElementById("_cm-css-reset")}catch(p){}if(!q){return false}var o=l.getElementsByClassName("_cm-video-ad");var m=Array.apply(null,o);var s=j.viewportWidth(l);var n=m.filter(function(u){var t=j.cumulativeOffset(u);return u.getBoundingClientRect&&u.getBoundingClientRect().width>0&&u.getBoundingClientRect().height>0&&(t.top!=0||t.left!=0)&&s-t.right>-20&&u.style&&u.style.display!=="none"});return n.length>0};j.viewportWidth=function(l){var n=0;try{n=Math.max(l.documentElement.clientWidth,window.innerWidth||0,window.parent.innerWidth||0)}catch(m){}return n};j.cumulativeOffset=function(l){var p=0,o=0;var m=100;try{do{p+=l.offsetTop||0;o+=l.offsetLeft||0;l=l.offsetParent}while(l&&m-->0)}catch(n){j.log("excption in cumulativeOffset: "+n.message)}return{top:p,left:o}};j.detectOsServedTeads=function(o){var n=j.getTopDoc();if(!n){return false}var m=n.getElementsByClassName("teads-player");var l=Array.prototype.slice.call(m).some(function(s){var q=s.getElementsByTagName("iframe");if(q.length!=1){return false}var r=q[0];var p=j.safeGetBoundingClientRect(r);return p.height>0&&p.width>0});return l};j.detectServedByHeight=function(m,p,o){var l=1;var n=p&&p.h&&m&&p.h>=m-l&&!j.ignoreHeightForNetwork(o)?true:false;return n};j.ignoreHeightForNetwork=function(m){var l={e:true,z:true};return l[m]?true:false};j.cookieSync=function(l,m){if(!k.cs.js){k.cs.js=h.async_js(k.ext_src+"-cs.js",{})}if(!d.kmn_cs&&!k.cs[l]){k.cs[l]=d.setInterval(function(){j.cookieSync(l,m)},100)}else{if(d.kmn_cs){d.clearInterval(k.cs[l]);d.kmn_cs.cookieSync(l,m)}}};j.heartbeat=function(l){if(!d.kmn_hb&&!k.hb){h.async_js(k.ext_src+"-hb.js",{});k.hb=d.setInterval(function(){j.heartbeat(l)},50)}else{if(d.kmn_hb){d.clearInterval(k.hb);d.kmn_hb.start(l)}}};j.heartbeat_stop=function(l){if(d.kmn_hb){d.kmn_hb.stop(l)}};j.getDataVar=function(m,l,n){if(kmn_data[m]&&typeof kmn_data[m][l]!=="undefined"){return kmn_data[m][l]}return typeof n!=="undefined"?n:null};j.setDataVar=function(m,l,o){var n=kmn_data[m]&&kmn_data[m][l]?kmn_data[m][l]:null;if(!kmn_data[m]){kmn_data[m]={}}kmn_data[m][l]=o;return n};j.incrementDataVar=function(m,l){return j.setDataVar(m,l,j.getDataVar(m,l,0)+1)};j.deleteDataVar=function(m,l){delete kmn_data[m][l]};j.setDynamicPassback=function(l,m){kmn_house[l]=m};j.initTagParamsOfAutoRefresh=function(l,m){if(m){if(!j.getMyBigBrotherTagid(l)){var n=j.getExternalTagLastCode(m);j.setDataVar(l,"bb_pl",m);j.setDataVar(l,"bb_code",n)}kmn_overlay=kmn_overlay||{};kmn_overlay[l]=true;var o=j.build_js("kmn_sa.autoRefreshPassback('"+l+"'); ",1);j.setDynamicPassback(l,o)}};j.tag=function(o,p){try{p=p||null;var n=j.tags;j.is_debug();if(d.kmn_size){o=o+"_"+d.kmn_size.replace("x","_");delete d.kmn_size}if(d.kmn_passback){if(typeof d.kmn_passback=="string"){j.setDynamicPassback(o,d.kmn_passback);delete d.kmn_passback}else{if(_typeof(d.kmn_passback)=="object"){if(d.kmn_passback[o]){j.setDynamicPassback(o,d.kmn_passback[o])}}}}if(!n[o]){j.initTagParams(o,p)}else{if(n[o].parent){o=n[o].parent}delete n[o].ar;n[o].cnt+=1}j.initHeaderBidding(o);if(j.isHeaderBidding(o)){var r={tagid:o},s=g.getElementById(c+o);var m=j.getHdbdId();if(m){j.setDataVar(o,"hdbdId",m)}if(!s){j.addKmniDiv(o)}j.log("hdbd request["+o+"]");var l=j.handleHdbdResponse.bind(undefined,r);if(j.canAccessBidstore(o)){j.log("tag["+o+"]has direct access to bidStore, sending req in sync mode")}else{j.log("tag["+o+"]has no direct access to bidStore, sending req in async mode and setting listener");komoona_xd.receive(l)}j.set_ts(o,"hbq");j.requestHdbdData(o,l);d.setTimeout(function(){var t=j.getDataVar(o,"hdbdResponseStatus");if(t!==j.HDBD_STATE_RECEIVED&&t!==j.HDBD_STATE_FULL){j.setDataVar(o,"hdbdResponseStatus",j.HDBD_STATE_TIMEOUT);j.log("hdbd no response["+o+"]state["+t+"]new state["+j.getDataVar(o,"hdbdResponseStatus")+"]");j.dtag(o)}else{}},j.hdbdTagTimeout)}else{j.dtag(o)}}catch(q){j.spark(o,{err:"tag@sa",msg:q.message})}};j.initHeaderBidding=function(m){var l=window.kmn_hb_data||{};if(l[m]){j.setDataVar(m,"hbtype","kbidder");var q=l[m].s2s_type;if(q){j.setDataVar(m,"s2s_type",q)}for(var n in l){if(l[n].creative_data){try{var p=l[n].creative_data;window.kmn_hb_data[n].creative_data=JSON.parse(p)}catch(o){j.log("kbidder: failed to parse creative_data ["+n+"]");j.spark(m,{err:"creative@init"})}}}}else{try{if(window.kmn_hdbd&&window.kmn_hdbd.hb_placements&&window.kmn_hdbd.hb_placements.indexOf(m)>-1||window.top.kmn_hbid&&j.canAccessBidstore(m,"hdbd")&&j.getBidstoreData(m,"hdbd")!==null){j.setDataVar(m,"hbtype","hdbd")}}catch(o){j.log("hdbd: couldn't access window.top")}}return j.getDataVar(m,"hbtype")!==null};j.isHeaderBidding=function(l){return j.getDataVar(l,"hbtype")!==null};j.getHdbdId=function(){var l=null;try{if(window.top.kmn_hbid){l=window.top.kmn_hbid}}catch(m){j.log("hdbd: couldn't access window.top")}return l};j.getTopBidstore=function(){var l;try{l=window.top.kmn_bids_store}catch(m){}if(!l){try{l=window.kmn_bids_store||(j.getParent()?j.getParent().kmn_bids_store:null)||(j.getParent()?j.getParent().parent.kmn_bids_store:null)}catch(m){}}return l};j.canAccessBidstore=function(m,l){l=typeof l!=="undefined"?l:j.getDataVar(m,"hbtype");switch(l){case"kbidder":if(window.kmn_hb_data){return true}case"hdbd":if(j.getTopBidstore()){return true}}return false};j.getBidstoreData=function(m,l){l=typeof l!=="undefined"?l:j.getDataVar(m,"hbtype");switch(l){case"kbidder":if(typeof kmn_hb_data!=="undefined"&&kmn_hb_data[m]&&kmn_hb_data[m]["creative_data"]){return kmn_hb_data[m]["creative_data"]}case"hdbd":var n=j.getTopBidstore();if(n){return n._HBData(m)}}return null};j.getLatestBidstoreDataForHB=function(l){var n=j.getBidstoreData(l,"hdbd");if(n&&n.hdbd_data){return n.hdbd_data}var o=j.getDataVar(l,"hdbdResponse");if(o){return o}var m=j.getBidstoreData(l,"kbidder");if(m&&m.hdbd_data){return m.hdbd_data}return null};j.getHighestHBBid=function(m){if(m&&m.hbbids&&_typeof(m.hbbids)==="object"){var o=m.hbbids;var n=Object.keys(o).filter(function(p){return j.getHBBidCpm(o[p])&&j.getHBBidCpm(o[p])>0});var l=n.reduce(function(s,q,r,p){return j.getHBBidCpm(o[q])>(o[s]?j.getHBBidCpm(o[s]):0)?q:s},"");if(l){return o[l]}}return null};j.getHBBidCpm=function(l){if(l&&l.sb){return l.sb}return 0};j.getKBidderData=function(l){if(j.getDataVar(l,"hbtype")==="kbidder"&&j.canAccessBidstore(l)&&window.kmn_hb_data[l]){return window.kmn_hb_data[l]}return null};j.requestHdbdData=function(m,n){if(j.canAccessBidstore(m)){var l=j.getBidstoreData(m);n({data:l})}else{komoona_xd.post({msg_type:"hdbdRequest",params:{placement_id:m}},"*",d.top)}};j.handleHdbdResponse=function(q,p){j.setDataVar(q.tagid,"hdbdRetries",j.getDataVar(q.tagid,"hdbdRetries",0));var m=p.data;if(m&&m.msg_type==="hdbdData"&&m.hdbd_data&&m.hdbd_data.placement_id===q.tagid){var n=m.hdbd_data;var r=j.setDataVar(q.tagid,"hdbdResponse",n);if(!r){var o=j.set_ts(q.tagid,"hbr");j.setDataVar(q.tagid,"hdbdResponseTime",o);j.log("got first hdbd response for tag "+q.tagid+" at "+o)}if(j.getDataVar(q.tagid,"hdbdResponseStatus")!==j.HDBD_STATE_TIMEOUT){if(j.getDataVar(q.tagid,"hbtype")==="kbidder"||j.isFullHdbdResponse(n)){if(j.getDataVar(q.tagid,"hdbdResponseStatus")!==j.HDBD_STATE_FULL){j.setDataVar(q.tagid,"hdbdResponseStatus",j.HDBD_STATE_FULL);j.log("tag "+q.tagid+": full hdbd response received, proceeding to tag.");j.set_ts(q.tagid,"fhb");j.callTagInHdbdFlow(q.tagid)}}else{j.setDataVar(q.tagid,"hdbdResponseStatus",j.HDBD_STATE_RECEIVED);var l=j.getDataVar(q.tagid,"hdbdRetries")+1;j.setDataVar(q.tagid,"hdbdRetries",l);if(l<j.maxHdbdTagRetries){setTimeout(function(){j.requestHdbdData(q.tagid,j.handleHdbdResponse.bind(undefined,q))},j.hdbdRetryWait)}else{j.log("debug: waited for full hdbd response for too long in tag "+q.tagid+", stopping retries. Proceeding to tag. latest reponse: "+j.stringify(n)+"(retries="+l+")");j.callTagInHdbdFlow(q.tagid)}}}else{j.log("got hdbd response for tag "+q.tagid+" after timeout was deemed, ignoring (ts="+j.getDataVar(q.tagid,"hdbdResponseTime")+")")}}};j.callTagInHdbdFlow=function(l){if(!j.getDataVar(l,"hdbdFlowTag",false)){j.setDataVar(l,"hdbdFlowTag",true);if(!j.determineAndStoreHBWinner(l)){if(j.getDataVar(l,"hbtype")==="kbidder"){j.spark(l,{err:"winner@hdbd"})}}j.dtag(l)}else{j.log("refraining from calling dtag twice in hdbd flow")}};j.determineAndStoreHBWinner=function(l){var m=j.getLatestBidstoreDataForHB(l);j.setDataVar(l,"hdbdResponseInUse",m);if(m){var n=j.getHighestHBBid(m);j.setDataVar(l,"kbWinningElement",n);return true}return false};j.getBidDataForACall=function(m){var q=j.getDataVar(m,"hdbdResponseInUse");var l=j.getDataVar(m,"kbWinningElement");var p=[];if(q&&q.hbbids){for(var n in q.hbbids){var o=q.hbbids[n];var r={code:o.code,ret:o.returned,cpm:o.cpm?o.cpm:null};j.mAddIfExists(r,o,["error","reqts","rests","bid_id","sb","rb","gap","nap","fp","spt"]);if(o.creative_data&&typeof o.creative_data.cpm_second!=="undefined"){r.secprice=o.creative_data.cpm_second}if(j.isTheWinningElement(m,r)){r.kb=true}p.push(r)}}return j.stringify(p)};j.addIfExists=function(n,l,m){if(typeof l[m]!=="undefined"){n[m]=l[m]}};j.mAddIfExists=function(n,l,m){m.forEach(function(o){return j.addIfExists(n,l,o)})};j.isTheWinningElement=function(n,m){var l=j.getDataVar(n,"kbWinningElement");if(l&&l.code&&m.code===l.code&&!!l.rb==!!m.rb){return true}return false};j.isFullHdbdResponse=function(m){var n=false;if(m.hbbids){for(var l in m.hbbids){if(m.hbbids[l].returned===false){return false}else{n=true}}if(n){return true}}return false};j.serveHdbdEscapedHtml=function(n,p,q){var l=false;if(p&&p.creative_data&&p.creative_data.creative){var m=p.creative_data.creative.replace(/[\n\r\f]/g," ");var o='<div id="kmnp-'+n+'">'+m+"</div>";l=j.renderIframeWithHtmlToCurrentDiv(n,o)}else{j.spark(n,{err:"creative@hdbd"});kmn_sa.log("warning: no creativeData/creative in "+q+" hdbd, responseData="+JSON.stringify(p))}return l};j.serveHdbdSovrn=function(o,q){kmn_sa.log("serveHdbdSovrn: serving");var m=false;if(q&&q.creative_data&&q.creative_data.creative){var n=decodeURIComponent(q.creative_data.creative);var p='<div id="kmnp-'+o+'">'+n+"</div>";var l="";if(q.creative_data.nurl){l+="<img src='"+q.creative_data.nurl+"'></img>"}p+=l;m=j.renderIframeWithHtmlToCurrentDiv(o,p)}else{j.spark(o,{err:"creative@ihdbd"});kmn_sa.log("warning: no creativeData/creative in S hdbd, responseData="+q)}return m};j.serveHdbdApn=function(m,p){var l=false;if(p&&p.creative_data&&p.creative_data.creative){var q=j.getDoc();var o=j.getWrapper(m);if(o){var n=j.create_iframe(p.creative_data.creative,o,{width:j.getDataVar(m,"w",0),height:j.getDataVar(m,"h",0),border:"0px",frameBorder:"0",scrolling:"no",id:j.generateIframeId(m)});l=true}else{j.log("can't find div in hdbd an");j.spark(m,{err:"div@anhdbd"})}}else{j.spark(m,{err:"creative@anhdbd"});kmn_sa.log("warning: no creativeData/creative in an hdbd, responseData="+p)}return l};j.serveHdbdIndex=function(o,q){var l=false;if(q&&q.creative_data&&q.creative_data.creative){var n=j.getDataVar(o,"winning_bid");if(n){var p=q.creative_data.creative;p=p.replace("${AUCTION_PRICE}",n);var m=p.replace(/\'/g,"\\'");m=m.replace(/[\n\r\f]/g," ");m='<div id="kmnp-'+o+'">'+m+"</div>";l=j.renderIframeWithHtmlToCurrentDiv(o,m)}else{j.spark(o,{err:"wp@jhdbd"});j.log("warning: no winning price in j hdbd")}}else{j.spark(o,{err:"creative@jhdbd"});j.log("warning: no creativeData/creative in j hdbd, responseData="+q)}return l};j.serveHdbdPubmatic=function(l,m,s){if(m.creative_data){var o=m.creative_data.bidsObject,p=m.creative_data.pbkey,r="//ads.pubmatic.com/AdServer/js/gshowad.js";if(o&&p){var n=function n(y,w){var u=false;var A="";if(w){A=w}else{var z="window.bidDetailsMap = {};";z+="var bidString = '"+j.stringify(o)+"';";z+="window.bidDetailsMap['"+p+"'] = JSON.parse(bidString);";var v="";v+="<html><head><script>"+z+"<\/script>";v+="<script src='"+r+"'><\/script>";v+="<script>PubMaticGrouped.displayCreative('"+p+"')<\/script></head><body></body></html>";var x=j.getWrapper(l);if(x){j.createIframeWithHtml(v,x,{width:j.getDataVar(l,"w",0),height:j.getDataVar(l,"h",0),border:"0px",frameBorder:"0",scrolling:"no",id:"kmnp-"+l});u=true}else{j.log("can't find div in hdbd p");A="div@phdbd"}}y(u,A)};if(d.PubMaticGrouped){n(s,null)}else{h.async_js(r,{});j.waitForPubmaticPG(n,s)}}else{if(m.creative_data.creative){var t=j.serveHdbdS2s(l,m,"p");var q=null;if(!t){j.log("warning: failed in s2s p hdbd");q="s2s@phdbd"}s(t,q)}else{j.log("warning: no bidObject/pbKey in p hdbd");s(false,"bo@phdbd")}}}else{j.log("warning: no creativeData in p hdbd");s(false,"cd@phdbd")}};j.serveHdbdS2s=function(o,q,r){var l=false;if(q&&q.creative_data&&q.creative_data.creative){var n=j.getDataVar(o,"winning_bid");if(n){var p=q.creative_data.creative;p=p.replace(/\$\{AUCTION_PRICE\}/g,n);var m=p.replace(/[\n\r\f]/g," ");m='<div id="kmnp-'+o+'">'+m+"</div>";l=j.renderIframeWithHtmlToCurrentDiv(o,m)}else{j.spark(o,{err:"wp@"+r+"hdbd"});j.log("warning: no winning price in "+r+" hdbd")}}else{j.spark(o,{err:"creative@"+r+"hdbd"});j.log("warning: no creativeData/creative in "+r+" hdbd, responseData="+q)}return l};j.waitForPubmaticPG=function(p,n){var r=null;var q=30;var o=0;var l=false;r=d.setInterval(function m(){o++;if(d.PubMaticGrouped){p(n,null);l=true}if(l||o>q){d.clearInterval(r);if(!l){n(false,"no PG after timeout")}}},100)};j.renderIframeWithHtmlToCurrentDiv=function(m,n){var o=j.getWrapper(m);var l={width:j.getDataVar(m,"w",0),height:j.getDataVar(m,"h",0),border:"0px",frameBorder:"0",scrolling:"no",id:"kmnr-"+m};if(o){j.createIframeWithHtml(n,o,l);return true}return false};j.createIframeWithHtml=function(o,n,m){n=typeof n!=="undefined"?n:document.head;m=typeof m!=="undefined"?m:{};var p=document.createElement("iframe");for(var l in m){p[l]=m[l]}n.appendChild(p);p.contentWindow.document.open();p.contentWindow.document.write(o);p.contentWindow.document.close()};j.getHdbdDataForAnyTag=function(m,p){var n=j.getDataVar(m,"hdbdResponseInUse");var l=[];if(n&&n.hbbids){var o=Object.keys(n.hbbids).filter(function(q){return n.hbbids[q].code===p});o.forEach(function(q){return l.push(n.hbbids[q])})}return l};j.getHdbdDataForWinningTag=function(l,n){var o=j.getHdbdDataForAnyTag(l,n);var m=o.filter(function(p){return j.isTheWinningElement(l,p)});if(m.length>=1){if(m.length>1){j.spark(l,{err:"hdbdd4t@hdbd",msg:"len="+m.length})}return m[0]}return null};j.isHdbdTag=function(m,n){var l=j.getHdbdDataForWinningTag(m,n);if(l){return true}return false};j.isPostbidTag=function(l,n){var m=j.getDataVar(l,"postbid_code","");return n===m};j.recordOxServed=function(m,l){if(l&&l.get){var o=false;var q=l.get("pub_rev");if(q){var p=escape(q);if(!isNaN(p)&&p>0){j.setDataVar(m,"cpm",p/1000)}o=true}var n=l.get("is_fallback");if(o||typeof n!=="undefined"&&!n){j.setDataVar(m,"tagSurelyServed",true)}}};j.recordSmaatoServed=function(m,l){if(l=="SUCCESS"){j.setDataVar(m,"tagSurelyServed",true)}};j.notifyBidUse=function(m,l){try{if(l&&l.bid_id){var n=j.getTopBidstore();if(n){return n.notifyBidUsed(m,l.bid_id)}}}catch(o){j.spark(m,{err:"notifyBidUse@hdbd",msg:o.message})}return false};j.callHdbd=function(o,p,r){var m=j.getHdbdDataForWinningTag(o,p);var l=false;var n="";j.notifyBidUse(o,m);if(m){try{switch(m.network){case"pubmatic":j.serveHdbdPubmatic(o,m,r);break;case"rhythmone":l=j.serveHdbdEscapedHtml(o,m,"M");if(!l){n="err@hdbdM"}break;case"inneractive":l=j.serveHdbdEscapedHtml(o,m,"I");if(!l){n="err@hdbdI"}break;case"cpx":l=j.serveHdbdApn(o,m);if(!l){n="err@hdbdan"}break;case"sovrn":l=j.serveHdbdSovrn(o,m);if(!l){n="err@dbdbS"}break;case"s2s":case"taboola":l=j.serveHdbdS2s(o,m,"U");if(!l){n="err@hdbdU"}break;case"openx":l=j.serveHdbdEscapedHtml(o,m,"e");if(!l){n="err@hdbde"}break;default:j.log("hdbd doesn't know how to serve code "+p);n="hdbdnc"+p}}catch(q){n=q.message;j.spark(o,{err:"serving@hdbd",dft:j.stringify(m),msg:q.message})}}else{n="no data";j.spark(o,{err:"tagData@hdbd",msg:"nd"})}if(l){r(true,null)}else{if(n){r(false,n)}else{j.log("waiting for hdbd callback")}}};j.hdbdTagCallback=function(m){j.log("dbg: Tag callback called for "+m+", starting chain");try{if(d.kmn_passbacks&&kmn_passbacks[m]){kmn_np.next(m)}else{j.log("np not loaded yet, waiting");var o=0;var l=50;var p=60;var n=setInterval(function(){o++;if(d.kmn_passbacks&&kmn_passbacks[m]){j.log("np loaded, nexting (count="+o+")");clearInterval(n);kmn_np.next(m)}else{if(o>p){j.log("np taking too long, fetching again");clearInterval(n);j.fetch_np(m)}}},l)}}catch(q){j.spark(m,{err:"hdbdCallback@sa",msg:q.message})}};j.readyStateDontWrite=function(l){return l==="loaded"||l==="complete"||l==="interactive"};j.dtag=function(G){var B={},t=j.live_tags(G),D={l:j.site_url(),v:k.v,cb:kmn_cb},m="tag/";if(t.length){var y,C=[];for(y in t){C.push(j.getDataVar(t[y],"codes",""))}D.s=t.join(";");if(C.length){D.codes=C.join(";")}}else{j.cssClass({"kmn-div":"border:none;padding:0;background:transparent;position:relative;display:inline-block;"})}var x=j.getMyBigBrotherTagid(G);var E,s=j.tags[G].cnt,v=j.getKmniDiv(G);var l=false;var r=j.getDataVar(G,"hbtype");if(r!=="kbidder"){if(v||j.tags[G].async||j.readyStateDontWrite(g.readyState)||x||r==="hdbd"){l=true}}else{j.tags[G].async=false}if(s>1){D.n=s;var p=0,u=g.getElementsByTagName("div"),n=g.getElementById(b+G),A=!(j.tags[G].div||n);if(!A){for(;p<u.length;p++){if(u[p]===j.tags[G].div||u[p]===n){A=u[p]}}}if(!A){if(!j.hasServingEnded(G)){j.house(G)}j.tags[G].ar=D.ar=1;komoona_xd.receive(function(H){j.handle(H.data)})}var w=j.getDataVar(G,"codes");if(w){D.chain=w}if(n){E=j.findTag(n,G)}D.loop=E?true:false;D.srv=j.hasServingEnded(G);m="passback/hp/";if(v&&!j.tags[G].ar){v.setAttribute("id",c+G+"_"+s)}}else{if(l){delete D.l;B.asmk=1;B.atob=d.atob?1:0}j.spark(G,B)}var q=j.getDataVar(G,"hdbdResponseStatus");if(q===j.HDBD_STATE_RECEIVED||q===j.HDBD_STATE_FULL){j.log("tag["+G+"]: using hdbd data");D.hbBids=j.getBidDataForACall(G);var z=j.getKBidderData(G)}var o=h.stat_src(k.base_url+m+G+".js",D);var F=j.getDataVar(G,"bb_code");if(F){D.bb_code=F}if(k.debug){o+="&"+f}j.log("tag["+o+"]async["+l+"]");if(!l){j.write_js(o)}else{j.atag(G,o+"&asmk=1",v)}};j.generateIframeId=function(l){return"kmnp-"+l+"-"+Math.round(Math.random()*1000)};j.atag=function(l,p,r){j.setServingEnded(l);try{if(!r){r=j.addKmniDiv(l)}if(r){var n=d.atob,q=n?"about:blank":p.replace(l+".js?",l+".html?l="+encodeURIComponent(j.site_url())),m=j.create_iframe(q,r,{id:j.generateIframeId(l)},j.isOverlay(l));if(m&&n){p='document.write(\'<script type="text/javascript" src="'+p+"&l='+encodeURIComponent(kmn_sa.site_url())+'\"></'+'script>');";j.log("atag["+p+"]");j.iframe_with_content(m,j.build_js(p,1),l,0)}}}catch(o){j.spark(l,{err:"atag@sa",msg:o.message})}};j.getKmniDiv=function(m){var r,p=c+m,l=0,n=g.getElementsByTagName("div");try{for(;l<n.length;l++){if(n[l].id===p&&n[l].className.indexOf(a)===-1){r=n[l];var o=r.className||"";if(r.classList){r.classList.add(a)}else{r.className=o!==""?o+" "+a:a}break}}}catch(q){}return r};j.getTopAsyncKmniDiv=function(m,o){try{var u=c+m;var t=window;for(var q=0;q<o;q++){var s=t.document.getElementsByTagName("div");for(var p=0;p<s.length;p++){var l=s[p];if(l.id==u&&l.className===a){return l}}if(t!=t.parent){t=t.parent}else{return null}}return null}catch(r){j.spark(m,{err:"getTopAsyncKmniDiv@sa",msg:r.message});return null}};j.getKmniId=function(m){var l=j.tags[m].ar||j.tags[m].cnt,n=c+m+(l>1?"_"+l:"");return n};j.addKmniDiv=function(o){var n,l=j.getKmniId(o),s=g.getElementById(l);j.log("kmnid["+l+"]["+s+"]");if(!s){var q=j.getMyBigBrotherTagid(o);if(q){var m=j.getWrapper(q);if(m){var p=j.setAttributes(g.createElement("div"),{id:l,"class":a});p.style.position="absolute";p.style.zIndex=100;p.style.pointerEvents="none";m.insertBefore(p,m.firstChild)}else{j.spark(o,{err:"autorefresh@akd"})}}else{try{n=j.findTag(j.getDoc().getElementsByTagName("body")[0],o)}catch(r){}if(n){var p=j.setAttributes(g.createElement("div"),{id:l,"class":a});n.parentNode.insertBefore(p,n)}else{if(!j.readyStateDontWrite(g.readyState)||j.getDataVar(o,"hbtype")==="kbidder"){g.write('<div id="'+l+'" class="'+a+'"></div>')}else{j.spark(o,{err:"w@akd"})}}}s=g.getElementById(l)}return s};j.findTag=function(n,l){var m=j.findTagDefinition(n,l);if(!m){var o=j.getMyBigBrotherTagid(l);if(o){m=j.findTagDefinition(n,o)}}return m};j.findTagDefinition=function(q,n){var o,p,m,l;if(q){try{l=q.getElementsByTagName("script")||[];for(p in l){m=l[p].text||"";if(m.indexOf("kmn_placement")!==-1&&m.indexOf(n)!==-1){o=l[p];break}}}catch(r){}}return o};j.hideElement=function(l){if(l){if(!l.style){l.style={}}l.style.display="none";l.style.height="0px"}};j.bt=function(l){j.stats(l,{order:"",bt:true})};j.xtag=function(o){try{var n=o.tid,q=kmn_data[n],t="kmnx_"+n;if(j.hasServingEnded()){j.spark(n,{err:"asyncEnd@sa",msg:"xtag"})}else{if(!g.getElementById(t)){j.setServingEnded(n);j.log("xtag: "+t);var m=j.getWrapper(n);var r=0,l=m?m.getElementsByTagName(o.e||"ins"):[];for(;r<l.length;r++){j.hideElement(l[r])}var p=j.create_iframe("about:blank",m,{id:t,width:j.getDataVar(n,"w"),height:j.getDataVar(n,"h")},j.isOverlay(n));var s=j.build_js("kmn_sa.get_np('"+n+"')",1);j.iframe_with_content(p,s,n,1)}else{j.spark(n,{err:"kmnx_exists@sa",msg:"2xtag"})}}}catch(u){j.spark(n,{err:"xtag@sa",msg:u.message})}};j.iframe_with_content=function(o,l,n,p){var m=j.generate_iframe_content(l,n,p);return j.writeContentToIframe(o,m)};j.stringifyWithEscaping=function(l){return encodeURIComponent(j.stringify(l)).replace(/'/g,"%27")};j.varFromEncodedJs=function(l,m){return l+"=JSON.parse(decodeURIComponent('"+m+"'.replace(/%27/g, \"'\")));"};j.generate_iframe_content=function(u,x,p){var l=[];l.push("kmn_cb="+kmn_cb);l.push("kmm_ts="+kmn_ts);l.push("kmn_options="+j.stringify(d.kmn_options||{}));l.push("kmn_data=kmn_data||{}");l.push("kmn_house=kmn_house||{}");l.push("kmn_overlay=kmn_overlay||{}");if(window.kmn_hb_data){l.push("kmn_hb_data=kmn_hb_data||{}")}var q="var "+l.join(",")+";";if(kmn_data[x]){var s=j.stringifyWithEscaping(kmn_data[x]);q+=j.varFromEncodedJs('kmn_data["'+x+'"]',s)}if(kmn_house[x]){var s=j.stringifyWithEscaping(kmn_house[x]);q+=j.varFromEncodedJs('kmn_house["'+x+'"]',s)}if(kmn_overlay[x]){q+='kmn_overlay["'+x+'"]='+kmn_overlay[x]+";"}if(window.kmn_hb_data&&kmn_hb_data[x]){var y=j.stringifyWithEscaping(kmn_hb_data[x]);q+=j.varFromEncodedJs('kmn_hb_data["'+x+'"]',y)}if(typeof kmn_serving_callback==="function"){q+="kmn_serving_callback="+kmn_serving_callback+";"}var C=j.build_js(q,1);var A=j.tags[x];var n="";if(k.debug){n+="kmn_sa.options.debug=1;"}if(A.cnt<=1){n+="kmn_sa.initTagParams('"+x+"');kmn_sa.tags['"+x+"'].ts="+j.stringify(A.ts)+";kmn_sa.tags['"+x+"'].async="+A.async+";"}var v=j.build_js(n,1);if(p){u='<div id="'+b+x+'" class="'+a+'">'+u+"</div>"}var o="<!DOCTYPE HTML><html><head>",B="</body></html>",w="</head>",t=j.build_js(j.options.ext_src+"_"+j.options.sa+".js",0),z=o+C+t+v+w+'<body class="'+a+'">'+u+B;if(!p){var m=encodeURIComponent(z).replace(/'/g,"%27"),r=j.getKmniId(x);z=o+t+"<script>function kload(){komoona_xd.receive(function(response){kmn_sa.handle(response.data);komoona_xd.post(response.data,'*',parent);});;kmn_sa.tags['"+x+'\']={};var ifrm=kmn_sa.create_iframe("about:blank",document.getElementById("'+r+'"),{id:kmn_sa.generateIframeId("'+x+'")}, kmn_sa.isOverlay("'+x+"\")),ifrmDoc=kmn_sa.getIfrmDoc(ifrm);ifrmDoc.open();ifrmDoc.write(decodeURIComponent('"+m+"'));ifrmDoc.close();}<\/script>"+w+'<body onload="kload();"><div id="'+r+'">'+B}return z};j.writeContentToIframe=function(l,m){var n=j.getIfrmDoc(l);if(n){n.open();n.write(m);n.close()}};j.handle=function(o){try{var l=j.parseJson(o);if(l.type=="passbackInIframe"&&l.tid){j.xtag(l)}else{if(l.tagid&&l.w&&l.h){var n,q=g.getElementById(c+l.tagid);if(q){n=q.getElementsByTagName("iframe")[0];if(n){n.style.display=j.isOverlay(l.tagid)?"inline-block":"block";if(!isNaN(l.w)){l.w+="px"}if(!isNaN(l.h)){l.h+="px"}j.setAttributes(n,{width:l.w,height:l.h})}}}}}catch(p){var m=l?l.tid||l.tagid:null;if(m){j.spark(m,{err:"handle@sa",msg:p.message})}}};j.parseJson=function(m){var l;try{l=d.JSON&&d.JSON.parse?d.JSON.parse(m):new Function("return "+m)()}catch(n){}return l||{}};j.stringify=function(q){if(d.JSON&&d.JSON.stringify){return d.JSON.stringify(q)}else{var p=typeof q==="undefined"?"undefined":_typeof(q);if(p!=="object"||q===null){if(p==="string"){q='"'+q+'"'}return String(q)}else{var r,m,o=[],l=q&&q.constructor===Array;for(r in q){if(q.hasOwnProperty(r)){m=q[r];p=typeof m==="undefined"?"undefined":_typeof(m);if(p==="string"){m='"'+m+'"'}else{if(p==="object"&&m!==null){m=j.stringify(m)}}o.push((l?"":'"'+r+'":')+String(m))}}return(l?"[":"{")+String(o)+(l?"]":"}")}}};j.isMyBigBrotherClosed=function(l){try{return window.top.kmn_closed&&window.top.kmn_closed[l]}catch(m){j.log("debug: we are in an unfriendly iframe with brother tagid "+l);return false}};j.autoRefreshPassback=function(l){try{kmn_sa.log("Autorefresh passback of tagid ["+l+"] called");var n=kmn_sa.getTopAsyncKmniDiv(l,3);if(n){n.style.zIndex=-100}else{kmn_sa.spark(l,{err:"autoRefreshPassback@sa",msg:"No little brother kid div found for "+l})}}catch(m){kmn_sa.spark(l,{err:"autoRefreshPassback@sa",msg:m.message})}};j.autoRefreshServed=function(l){try{kmn_sa.log("Autorefresh with tagid ["+l+"] served - making it NOT trasparent to clicks");var n=kmn_sa.getTopAsyncKmniDiv(l,3);if(n){n.style.pointerEvents="auto"}else{kmn_sa.spark(l,{err:"autoRefreshServed@sa",msg:"No little brother kid div found for "+l})}}catch(m){kmn_sa.spark(l,{err:"autoRefreshServed@sa",msg:m.message})}};j.setAutoRefresh=function(m,l){if(!l||!l.timeout||!l.ar_placement||!l.blocked_ssps||!m){j.spark(m,{err:"setAutoRefresh@sa",msg:"Invalid AutoRefresh config"})}else{j.log("turning on AutoRefresh on for big brother ["+m+"] with little brother ["+l.ar_placement+"]");j.setDataVar(m,"ar_conf",l)}};j.runAutoRefreshTimeout=function(q,o){var m=j.getDataVar(q,"ar_conf");if(!m){j.log("No autorefresh set for "+q);return}var l=o.charAt(0);if(m.blocked_ssps.indexOf(l)!=-1){j.log("Big brother's served ssp is blocked for autorefresh - big brother ["+q+"] little brother ["+m.ar_placement+"] served code ["+o+"]");return}j.log("starting AutoRefresh for big brother ["+q+"] little brother ["+m.ar_placement+"] to refresh in ["+m.timeout+"] seconds");var p=m.timeout*1000;var n=d.setTimeout(function(r,t){return function s(){try{if(j.isMyBigBrotherClosed(t)){j.log("Big brother is a closed InImage - not starting autorefresh "+t);return}j.tag(r.ar_placement,t)}catch(u){j.spark(m.ar_placement,{err:"runAutoRefreshTimeout@sa",msg:u.message})}}}(m,q),p);return n};j.getMyBigBrotherTagid=function(l){return j.getDataVar(l,"bb_pl")};j.getExternalTagLastCode=function(l){return j.getLastCode(l)};j.getLastCode=function(m){var l=j.getDataVar(m,"order");if(!l){return""}var n=l.indexOf("|");var p=n>0?l.substr(0,n):l;var o=p.split("").reverse().join("");return o}}(),komoona_xd=komoona_xd||function(){var c=window;return{post:function a(d,g,f){if(c.postMessage){f.postMessage(d,g.replace(/([^:]+:\/\/[^\/]+).*/,"$1"))}},receive:function b(f){if(c.postMessage){var d=function d(g){return f(g)};if(c.addEventListener){c.addEventListener("message",d,false)}else{c.attachEvent("onmessage",d)}return d}}}}();function generateCb(){var a;if(window.kmn_hb_data){for(var c in window.kmn_hb_data){if(window.kmn_hb_data[c].cb){a=window.kmn_hb_data[c].cb;break}}}else{try{a=window.top.kmn_cb}catch(b){}}return a||window.kmn_cb||Math.floor(kmn_ts%65536+Math.floor(Math.random()*65536)*65536)}if(window.kmn_placement){var tag=window.kmn_placement;delete window.kmn_placement;kmn_sa.tag(tag)}else{(function(b,a){if(window.kmn_tags&&(a=kmn_tags.length)){for(b=0;b<a;++b){if(typeof kmn_tags[b]==="string"){kmn_sa.tag(kmn_tags[b])}}}})();kmn_tags={push:function push(a){kmn_sa.tag(a)}}};